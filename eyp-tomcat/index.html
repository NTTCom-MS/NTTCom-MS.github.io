<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.9
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_manifest_list_link"
        href="puppet_manifest_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-tomcat+rdoc-image%3Ahttps%3A%2F%2Fimg.shields.io%2Fbadge%2Fstatus-ready-brightgreen.svg">tomcat <img src="https://img.shields.io/badge/status-ready-brightgreen.svg"></h1>

<p><strong>NTTCom-MS/eyp-tomcat</strong>: <a
href="https://travis-ci.org/NTTCom-MS/eyp-tomcat"><img
src="https://travis-ci.org/NTTCom-MS/eyp-tomcat.png?branch=master"></a></p>

<h4 id="label-Table+of+Contents">Table of Contents</h4>
<ol><li>
<p><a href="#overview">Overview</a></p>
</li><li>
<p><a href="#module-description">Module Description</a></p>
</li><li>
<p><a href="#setup">Setup</a></p>
<ul><li>
<p><a href="#what-tomcat-affects">What tomcat affects</a></p>
</li><li>
<p><a href="#setup-requirements">Setup requirements</a></p>
</li><li>
<p><a href="#beginning-with-tomcat">Beginning with tomcat</a></p>
</li></ul>
</li><li>
<p><a href="#usage">Usage</a></p>
</li><li>
<p><a href="#reference">Reference</a></p>
</li><li>
<p><a href="#limitations">Limitations</a></p>
</li><li>
<p><a href="#development">Development</a></p>
<ul><li>
<p><a href="#contributing">Contributing</a></p>
</li></ul>
</li></ol>

<h2 id="label-Overview">Overview</h2>

<p>Multi instance tomcat installation</p>

<h2 id="label-Module+Description">Module Description</h2>

<p>Multi instance tomcat installation and configuration of:  * server.xml  *
context, connectors, reals, values…  * JVM memory settings  * context.xml 
* authenticators  * jaas  * jndi  * custom library deployment (tar.gz)  *
web.xml  * custom properties files  * postgres jdbc driver</p>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-What+tomcat+affects">What tomcat affects</h3>

<p>By default,  * <strong>CATALINA_HOME</strong>: /opt/tomcat-home (configured
on class <strong>tomcat</strong>)  * <strong>CATALINA_BASE</strong>:
“/opt/$name” (configured on define <strong>instance</strong>)</p>

<h3 id="label-Setup+Requirements">Setup Requirements</h3>

<p>This module requires pluginsync enabled and <strong>eyp/nsswitch</strong>
module installed, optionally <strong>eyp-java</strong></p>

<p>If <strong>eyp-logrotate</strong> is available, it can define catalina.out
file rotation</p>

<h3 id="label-Beginning+with+tomcat">Beginning with tomcat</h3>

<p>simple example:</p>

<pre class="code ruby"><code class="ruby">class { &#39;tomcat&#39;:
  tomcat_url =&gt; &#39;http://archive.apache.org/dist/tomcat/tomcat-7/v7.0.68/bin/apache-tomcat-7.0.68.tar.gz&#39;,
  nativelibrary =&gt; true,
}

tomcat::instance { &#39;tomcat-8080&#39;:
  tomcatpw =&gt; &#39;lol&#39;,
  shutdown_port=&gt;&#39;2022&#39;,
  ajp_port=&gt;&#39;8081&#39;,
  connector_port=&gt;&#39;8080&#39;,
  jmx_port =&gt; &#39;2021&#39;,
  lockoutrealm =&gt; false,
}

tomcat::instance { &#39;tomcat-8888&#39;:
  tomcatpw =&gt; &#39;lol&#39;,
  shutdown_port=&gt;&#39;9000&#39;,
  ajp_port=&gt;&#39;8885&#39;,
  connector_port=&gt;&#39;8888&#39;,
  jmx_port =&gt; &#39;9999&#39;,
  lockoutrealm =&gt; true,
}
</code></pre>

<h2 id="label-Usage">Usage</h2>

<h3 id="label-typical+configuration+options">typical configuration options</h3>

<h4 id="label-Multi+instance+installation+example%3A">Multi instance installation example:</h4>

<pre class="code ruby"><code class="ruby">---
paquets_general:
  - gcc
classes:
  - tomcat
  - java
java::java_package: java-1.8.0-openjdk
java::java_devel_package: java-1.8.0-openjdk-devel
tomcat::tomcat_src: puppet:///tomcat/apache-tomcat-7.0.57.tar.gz
tomcat::nativelibrary: true
tomcatinstances:
  tomcat8080:
    tomcatpw: a12345
    shutdown_port: 8070
    jmx_port: 8060
    ajp_port: &quot;&quot;
    connector_port: 8080
    xmx: 1024m
    xms: 512m
    realms:
      - es.systemadmin.es.sso.tomcat.SSORealm
    values:
      - org.apache.catalina.authenticator.SingleSignOn
    errorReportValveClass: es.systemadmin.es.sso.tomcat.SSOErrorValve
    lockoutrealm: false
    userdatabase: false
    extra_vars:
      CONNECTOR_PORT:
        8080
    rmi_server_hostname: &quot;%{::ipaddress_eth0}&quot;
  tomcat8081:
    tomcatpw: a12345
    shutdown_port: 8071
    jmx_port: 8061
    ajp_port: &quot;&quot;
    connector_port: 8081
    xmx: 1024m
    xms: 512m
    realms:
      - es.systemadmin.es.sso.tomcat.SSORealm
    values:
      - org.apache.catalina.authenticator.SingleSignOn
    errorReportValveClass: es.systemadmin.es.sso.tomcat.SSOErrorValve
    lockoutrealm: false
    userdatabase: false
    extra_vars:
      CONNECTOR_PORT:
        8081
    rmi_server_hostname: &quot;%{::ipaddress_eth0}&quot;
  tomcat8082:
    tomcatpw: a12345
    shutdown_port: 8072
    jmx_port: 8062
    ajp_port: &quot;&quot;
    connector_port: 8082
    xmx: 1024m
    xms: 512m
    realms:
      - es.systemadmin.es.sso.tomcat.SSORealm
    values:
      - org.apache.catalina.authenticator.SingleSignOn
    errorReportValveClass: es.systemadmin.es.sso.tomcat.SSOErrorValve
    lockoutrealm: false
    userdatabase: false
    extra_vars:
      CONNECTOR_PORT:
        8082
    rmi_server_hostname: &quot;%{::ipaddress_eth0}&quot;
  tomcat8083:
    tomcatpw: a12345
    shutdown_port: 8073
    jmx_port: 8063
    ajp_port: &quot;&quot;
    connector_port: 8083
    xmx: 1024m
    xms: 512m
    realms:
      - es.systemadmin.es.sso.tomcat.SSORealm
    values:
      - org.apache.catalina.authenticator.SingleSignOn
    errorReportValveClass: es.systemadmin.es.sso.tomcat.SSOErrorValve
    lockoutrealm: false
    userdatabase: false
    rmi_server_hostname: &quot;%{::ipaddress_eth0}&quot;</code></pre>

<h4 id="label-jaas+properties+example">jaas properties example</h4>

<pre class="code ruby"><code class="ruby">jaasproperties:
  tomcat8080:
    app: SystemAdminInternalConfig
    provider: ldap://1.2.3.4:389/ou=People,dc=systemadmin,dc=es
    filter: (&amp;(uid={USERNAME})(objectClass=inetOrgPerson))
  tomcat8081:
    app: SystemAdminInternalConfig
    provider: ldap://1.2.3.4:389/ou=People,dc=systemadmin,dc=es
    filter: (&amp;(uid={USERNAME})(objectClass=inetOrgPerson))
  tomcat8082:
    app: SystemAdminInternalConfig
    provider: ldap://1.2.3.4:389/ou=People,dc=systemadmin,dc=es
    filter: (&amp;(uid={USERNAME})(objectClass=inetOrgPerson))
  tomcat8083:
    app: SystemAdminInternalConfig
    provider: ldap://1.2.3.4:389/ou=People,dc=systemadmin,dc=es
    filter: (&amp;(uid={USERNAME})(objectClass=inetOrgPerson))</code></pre>

<h4 id="label-jndi+properties+example">jndi properties example</h4>

<pre class="code ruby"><code class="ruby">jndiproperties:
  tomcat8080:
    ldapservers:
      - &quot;ldap1.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
      - &quot;ldap2.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
    ldapbase: &quot;%{hiera(&#39;systemadmin::ldapbase&#39;)}&quot;
    ldapadmin: &quot;%{hiera(&#39;systemadmin::ldapadmin&#39;)}&quot;
    ldapadminpassword: &quot;%{hiera(&#39;openldap::server::adminpassword&#39;)}&quot;
  tomcat8081:
    ldapservers:
      - &quot;ldap1.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
      - &quot;ldap2.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
    ldapbase: &quot;%{hiera(&#39;systemadmin::ldapbase&#39;)}&quot;
    ldapadmin: &quot;%{hiera(&#39;systemadmin::ldapadmin&#39;)}&quot;
    ldapadminpassword: &quot;%{hiera(&#39;openldap::server::adminpassword&#39;)}&quot;
  tomcat8082:
    ldapservers:
      - &quot;ldap1.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
      - &quot;ldap2.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
    ldapbase: &quot;%{hiera(&#39;systemadmin::ldapbase&#39;)}&quot;
    ldapadmin: &quot;%{hiera(&#39;systemadmin::ldapadmin&#39;)}&quot;
    ldapadminpassword: &quot;%{hiera(&#39;openldap::server::adminpassword&#39;)}&quot;
  tomcat8083:
    ldapservers:
      - &quot;ldap1.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
      - &quot;ldap2.%{::ntteam_ptr_fqdn_tokenized_2}.systemadmin.es&quot;
    ldapbase: &quot;%{hiera(&#39;systemadmin::ldapbase&#39;)}&quot;
    ldapadmin: &quot;%{hiera(&#39;systemadmin::ldapadmin&#39;)}&quot;
    ldapadminpassword: &quot;%{hiera(&#39;openldap::server::adminpassword&#39;)}&quot;</code></pre>

<h4 id="label-authenticators+example">authenticators example</h4>

<pre class="code ruby"><code class="ruby">tomcatauthenticators:
  tomcat8080:
    basic: es.systemadmin.sso.tomcat.BasicAuthenticator
    form: es.systemadmin.sso.tomcat.FormAuthenticator
  tomcat8081:
    basic: es.systemadmin.sso.tomcat.BasicAuthenticator
    form: es.systemadmin.sso.tomcat.FormAuthenticator
  tomcat8082:
    basic: es.systemadmin.sso.tomcat.BasicAuthenticator
    form: es.systemadmin.sso.tomcat.FormAuthenticator
  tomcat8083:
    basic: es.systemadmin.sso.tomcat.BasicAuthenticator
    form: es.systemadmin.sso.tomcat.FormAuthenticator</code></pre>

<h4 id="label-library+tarball+installation+example">library tarball installation example</h4>

<pre class="code ruby"><code class="ruby">tomcatlibstarballs:
  tomcat8080:
    source: puppet:///customers/example/tomcatlibs.tgz
  tomcat8081:
    source: puppet:///customers/example/tomcatlibs.tgz
  tomcat8082:
    source: puppet:///customers/example/tomcatlibs.tgz
  tomcat8083:
    source: puppet:///customers/example/tomcatlibs.tgz</code></pre>

<h4 id="label-custom+tomcat+properties+file+deployment+example">custom tomcat properties file deployment example</h4>

<pre class="code ruby"><code class="ruby">tomcatproperties:
  catalina8080:
    properties_file: catalina
    source: puppet:///customers/example/catalina.properties
    catalina_base: /opt/tomcat8080
    servicename: tomcat8080
  catalina8081:
    properties_file: catalina
    source: puppet:///customers/example/catalina.properties
    catalina_base: /opt/tomcat8081
    servicename: tomcat8081
  catalina8082:
    properties_file: catalina
    source: puppet:///customers/example/catalina.properties
    catalina_base: /opt/tomcat8082
    servicename: tomcat8082
  catalina8083:
    properties_file: catalina
    source: puppet:///customers/example/catalina.properties
    catalina_base: /opt/tomcat8083
    servicename: tomcat8083
  logging8080:
    properties_file: logging
    source: puppet:///customers/example/logging.properties
    catalina_base: /opt/tomcat8080
    servicename: tomcat8080
  logging8081:
    properties_file: logging
    source: puppet:///customers/example/logging.properties
    catalina_base: /opt/tomcat8081
    servicename: tomcat8081
  logging8082:
    properties_file: logging
    source: puppet:///customers/example/logging.properties
    catalina_base: /opt/tomcat8082
    servicename: tomcat8082
  logging8083:
    properties_file: logging
    source: puppet:///customers/example/logging.properties
    catalina_base: /opt/tomcat8083
    servicename: tomcat8083</code></pre>

<h4 id="label-web.xml+example">web.xml example</h4>

<pre class="code ruby"><code class="ruby">tomcatwebxml:
  tomcat8080:
    source: puppet:///customers/example/web.xml
  tomcat8081:
    source: puppet:///customers/example/web.xml
  tomcat8082:
    source: puppet:///customers/example/web.xml
  tomcat8083:
    source: puppet:///customers/example/web.xml</code></pre>

<h4 id="label-context.xml+example">context.xml example</h4>

<pre class="code ruby"><code class="ruby">tomcatcontext:
  tomcat8080:
    sessionCookiePath: /
    antiJARLocking: true
    antiResourceLocking: true
  tomcat8081:
    sessionCookiePath: /
    antiJARLocking: true
    antiResourceLocking: true
  tomcat8082:
    sessionCookiePath: /
    antiJARLocking: true
    antiResourceLocking: true
  tomcat8083:
    sessionCookiePath: /
    antiJARLocking: true
    antiResourceLocking: true</code></pre>

<h4 id="label-update+library">update library</h4>

<pre class="code ruby"><code class="ruby">tomcat::lib { &#39;tomcat-8080&#39;:
  jar_name =&gt; &#39;ecj-4.4.3&#39;,
  source =&gt; &#39;puppet:///solr/ecj-4.4.3.jar&#39;,
}
</code></pre>

<h4 id="label-java+agent">java agent</h4>

<pre class="code ruby"><code class="ruby">tomcat::agent { &#39;tomcat-8080&#39;:
  agent_name =&gt; &#39;agenttest&#39;,
  comment =&gt; &#39;example agent&#39;,
  jar_name =&gt; &#39;agenttest-1.0.29&#39;,
  source =&gt; &#39;puppet:///tomcat/agenttest-1.0.29.jar&#39;,
}
</code></pre>

<h4 id="label-postgres+JDBC+driver">postgres JDBC driver</h4>

<pre class="code ruby"><code class="ruby">tomcatinstances:
  tomcat_retail01:
    tomcatpw: 123456
    xmx: 1024m
    xms: 1024m
    ajp_port: 9509
    maxpermsize: 384m
    heapdump_oom_dir: /opt/applogs/RETAIL01
  tomcat_retail50:
    tomcatpw: 123456
    xmx: 1024m
    xms: 1024m
    ajp_port: 9510
    maxpermsize: 384m
    heapdump_oom_dir: /opt/applogs/RETAIL50
tomcatdriverpostgres:
  tomcat_retail01: {}
  tomcat_retail50: {}</code></pre>

<h4 id="label-add+a+new+tomcatuser">add a new tomcatuser</h4>

<pre class="code ruby"><code class="ruby">tomcat::tomcatuser { &#39;tomcat-8080&#39;:
  tomcatuser =&gt; &#39;test&#39;,
  tomcatpw =&gt; &#39;lol&#39;,
}
</code></pre>

<h3 id="label-init+script+usage">init script usage</h3>

<h4 id="label-options">options</h4>

<pre class="code ruby"><code class="ruby">[root@ldapm ~]# /etc/init.d/tomcat-8080
Usage: /etc/init.d/tomcat-8080 start | stop | status | threadump | heapdump &lt;file&gt;</code></pre>

<h4 id="label-threadump">threadump</h4>

<p>Will create a thread dump on catalina.out</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># /etc/init.d/tomcat-8080 threadump
</span><span class='id identifier rubyid_thread'>thread</span> <span class='id identifier rubyid_dump'>dump</span> <span class='op'>-</span> <span class='const'>OK</span></code></pre>

<p>For example:</p>

<pre class="code ruby"><code class="ruby">Full thread dump OpenJDK 64-Bit Server VM (25.101-b13 mixed mode):

&quot;ajp-bio-8888-AsyncTimeout&quot; #20 daemon prio=5 os_prio=0 tid=0x00007f71343c7000 nid=0x226f waiting on condition [0x00007f7120fab000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.tomcat.util.net.JIoEndpoint$AsyncTimeout.run(JIoEndpoint.java:152)
	at java.lang.Thread.run(Thread.java:745)

&quot;http-bio-8080-AsyncTimeout&quot; #18 daemon prio=5 os_prio=0 tid=0x00007f71343c3800 nid=0x226d waiting on condition [0x00007f71211ad000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.tomcat.util.net.JIoEndpoint$AsyncTimeout.run(JIoEndpoint.java:152)
	at java.lang.Thread.run(Thread.java:745)

&quot;ContainerBackgroundProcessor[StandardEngine[Catalina]]&quot; #16 daemon prio=5 os_prio=0 tid=0x00007f71343b2800 nid=0x226b waiting on condition [0x00007f71213af000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.catalina.core.ContainerBase$ContainerBackgroundProcessor.run(ContainerBase.java:1513)
	at java.lang.Thread.run(Thread.java:745)

&quot;GC Daemon&quot; #13 daemon prio=2 os_prio=0 tid=0x00007f7134307800 nid=0x225c in Object.wait() [0x00007f7122d01000]
   java.lang.Thread.State: TIMED_WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x00000000e16a8560&gt; (a sun.misc.GC$LatencyLock)
	at sun.misc.GC$Daemon.run(GC.java:117)
	- locked &lt;0x00000000e16a8560&gt; (a sun.misc.GC$LatencyLock)

(...)

&quot;Finalizer&quot; #3 daemon prio=8 os_prio=0 tid=0x00007f7134089800 nid=0x220a in Object.wait() [0x00007f7123eaa000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x00000000e0008ee0&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
	- locked &lt;0x00000000e0008ee0&gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=0 tid=0x00007f7134085000 nid=0x2209 in Object.wait() [0x00007f7123fab000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &lt;0x00000000e0006b50&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.Object.wait(Object.java:502)
	at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
	- locked &lt;0x00000000e0006b50&gt; (a java.lang.ref.Reference$Lock)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)

&quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f7134009800 nid=0x2203 runnable [0x00007f713af9b000]
   java.lang.Thread.State: RUNNABLE
	at java.net.PlainSocketImpl.socketAccept(Native Method)
	at java.net.AbstractPlainSocketImpl.accept(AbstractPlainSocketImpl.java:409)
	at java.net.ServerSocket.implAccept(ServerSocket.java:545)
	at java.net.ServerSocket.accept(ServerSocket.java:513)
	at org.apache.catalina.core.StandardServer.await(StandardServer.java:453)
	at org.apache.catalina.startup.Catalina.await(Catalina.java:777)
	at org.apache.catalina.startup.Catalina.start(Catalina.java:723)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.catalina.startup.Bootstrap.start(Bootstrap.java:321)
	at org.apache.catalina.startup.Bootstrap.main(Bootstrap.java:455)

&quot;VM Thread&quot; os_prio=0 tid=0x00007f713407b800 nid=0x2208 runnable

&quot;VM Periodic Task Thread&quot; os_prio=0 tid=0x00007f71341a5800 nid=0x2253 waiting on condition

JNI global references: 51

Heap
 def new generation   total 157248K, used 100655K [0x00000000e0000000, 0x00000000eaaa0000, 0x00000000eaaa0000)
  eden space 139776K,  72% used [0x00000000e0000000, 0x00000000e624bfd8, 0x00000000e8880000)
  from space 17472K,   0% used [0x00000000e8880000, 0x00000000e8880000, 0x00000000e9990000)
  to   space 17472K,   0% used [0x00000000e9990000, 0x00000000e9990000, 0x00000000eaaa0000)
 tenured generation   total 349568K, used 0K [0x00000000eaaa0000, 0x0000000100000000, 0x0000000100000000)
   the space 349568K,   0% used [0x00000000eaaa0000, 0x00000000eaaa0000, 0x00000000eaaa0200, 0x0000000100000000)
 Metaspace       used 15177K, capacity 15452K, committed 15744K, reserved 1062912K
  class space    used 1547K, capacity 1609K, committed 1664K, reserved 1048576K</code></pre>

<h4 id="label-heapdump">heapdump</h4>

<p>Requires <strong>jmap</strong> installed</p>

<pre class="code ruby"><code class="ruby"># /etc/init.d/tomcat-8080 heapdump heap.bin
Dumping heap to /tmp/hsperfdata_tomcat/heap.bin ...
Heap dump file created</code></pre>

<h3 id="label-known+errors">known errors</h3>

<h4 id="label-error+installing+tomcat+native+library">error installing tomcat native library</h4>

<p>The following error means that you need to install the devel package for
java, for example <strong>java-1.7.0-openjdk-devel</strong>:</p>

<pre class="code ruby"><code class="ruby">Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: dirname: missing operand
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: Try &#39;dirname --help&#39; for more information.
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: dirname: missing operand
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: Try &#39;dirname --help&#39; for more information.
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: dirname: missing operand
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: Try &#39;dirname --help&#39; for more information.
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking build system type... x86_64-unknown-linux-gnu
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking host system type... x86_64-unknown-linux-gnu
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking target system type... x86_64-unknown-linux-gnu
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking for a BSD-compatible install... /usr/bin/install -c
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking for working mkdir -p... yes
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: Tomcat Native Version: 1.1.33
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking for chosen layout... tcnative
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking for APR... yes
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns:   setting CC to &quot;gcc&quot;
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns:   setting CPP to &quot;gcc -E&quot;
Notice: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: checking for JDK location (please wait)... configure: error: Not a directory:
Error: bash -c &quot;./configure --with-apr=/usr/bin/apr-1-config --with-java-home=$(dirname $(dirname $(dirname $(find / -xdev -iname jni_md.h | head -n1))))&quot; returned 1 instead of one of [0]
Error: /Stage[main]/Tomcat/Exec[configure native library /usr/local/src]/returns: change from notrun to 0 failed: bash -c &quot;./configure --with-apr=/usr/bin/apr-1-config --with-java-home=$(dirname $(dirname $(dirname $(find / -xdev -iname jni_md.h | head -n1))))&quot; returned 1 instead of one of [0]</code></pre>

<p>tomcat agent</p>

<pre class="code ruby"><code class="ruby">tomcat::agent { &#39;tomcat-8080&#39;:
  agent_name =&gt; &#39;demo&#39;,
  jar_name =&gt; &#39;demo&#39;,
  tar_source =&gt; &#39;puppet:///solr/apache-tomcat-7.0.62.tar.gz&#39;,
}
</code></pre>

<h2 id="label-Reference">Reference</h2>

<h3 id="label-Global+variables">Global variables</h3>
<ul><li>
<p><strong>eyptomcat::shutdowncommand</strong>: Defines a string to be used to
shutdown tomcat (default: SHUTDOWN)</p>
</li></ul>

<h3 id="label-classes">classes</h3>

<h4 id="label-tomcat">tomcat</h4>
<ul><li>
<p>installation options (at least one is required):</p>
</li><li>
<p><strong>tomcat_src</strong>: resource with the tomcat package (default:
undef)</p>
</li><li>
<p><strong>tomcat_url</strong>: URL to download the tomcat package (default:
undef)</p>
</li><li>
<p>other options:</p>
</li><li>
<p><strong>manage_tomcat_user</strong>: Manage or not the
<strong>tomcat_user</strong> user (default: true)</p>
</li><li>
<p><strong>tomcat_user</strong>: User to run tomcat (default: tomcat)</p>
</li><li>
<p><strong>tomcat_user_home</strong>: tomcat user home dir (default:
/home/tomcat)</p>
</li><li>
<p><strong>tomcat_user_shell</strong>: tomcat user shell (default: /bin/bash)</p>
</li><li>
<p><strong>catalina_home</strong>: where to install tomcat (default:
/opt/tomcat-home)</p>
</li><li>
<p><strong>srcdir</strong>: Place to store .tar.gz and other temporal files
(default: /usr/local/src)</p>
</li><li>
<p><strong>nativelibrary</strong>: Install tomcat native library (default:
true)</p>
</li></ul>

<h3 id="label-defines">defines</h3>

<h4 id="label-tomcat%3A%3Ainstance">tomcat::instance</h4>

<p>references: * [<a
href="http://www.fasterj.com/articles/oraclecollectors1.shtml](Oracle">www.fasterj.com/articles/oraclecollectors1.shtml](Oracle</a>
JVM Garbage Collectors) * [<a
href="https://blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/](Useful">blog.codecentric.de/en/2013/10/useful-jvm-flags-part-7-cms-collector/](Useful</a>
JVM Flags – Part 7 (CMS Collector)) * [<a
href="http://blog.sokolenko.me/2014/11/javavm-options-production.html](JVM">blog.sokolenko.me/2014/11/javavm-options-production.html](JVM</a>
options for production)</p>

<p>instance options:</p>
<ul><li>
<p>service options:</p>
</li><li>
<p><strong>ensure</strong> = &#39;running&#39;,</p>
</li><li>
<p><strong>manage_service</strong> = true,</p>
</li><li>
<p><strong>manage_docker_service</strong> = true,</p>
</li><li>
<p><strong>enable</strong> = true,</p>
</li><li>
<p>other options:</p>
</li><li>
<p><strong>tomcatpw</strong>: Password for tomcat GUI user (default:
<em>password</em>, <strong>must be changed</strong>)</p>
</li><li>
<p><strong>catalina_base</strong> = “/opt/$name”,</p>
</li><li>
<p><strong>instancename</strong> = $name,</p>
</li><li>
<p><strong>pwdigest</strong>: Hashing algorithm for tomcat-users.xml file,
valid values: sha, plaintext (default: sha)</p>
</li><li>
<p><strong>tomcat_user</strong> = $tomcat::params::default_tomcat_user,</p>
</li><li>
<p><strong>server_info</strong>: server identification for this version of
Tomcat (default: .)</p>
</li><li>
<p><strong>server_number</strong>: server&#39;s version number (default: .)</p>
</li><li>
<p><strong>server_built</strong>: server built time for this version of Tomcat
(default: .)</p>
</li><li>
<p><strong>xmx</strong>: JVM max memory: (default: 512m)</p>
</li><li>
<p><strong>xms</strong>: JVM start memory: (default: 512m)</p>
</li><li>
<p><strong>maxpermsize</strong>: JVM -XX:MaxPermSize (if available): (default:
512m)</p>
</li><li>
<p><strong>permsize</strong>: JVM -XX:PermSize (default: undef)</p>
</li><li>
<p><strong>shutdown_port</strong>: shutdown port (default: 8005)</p>
</li><li>
<p><strong>shutdown_address</strong>: shutdown listen address (default:
127.0.0.1)</p>
</li><li>
<p><strong>ajp_port</strong>: AJP listen port (default: undef)</p>
</li><li>
<p><strong>connector_port</strong>: HTTP connector port (default: 8080)</p>
</li><li>
<p><strong>connector_http_server</strong>: HTTP server Header (default: undef
which adds the default name: <strong>Server: Apache-Coyote/1.1</strong>)</p>
</li><li>
<p><strong>jmx_port</strong>: JMX listen port (default: 8999)</p>
</li><li>
<p><strong>redirectPort</strong> = &#39;8443&#39;,</p>
</li><li>
<p><strong>realms</strong> = undef,</p>
</li><li>
<p><strong>values</strong> = undef,</p>
</li><li>
<p><strong>errorReportValveClass</strong> = undef,</p>
</li><li>
<p><strong>maxThreads</strong>: tomcat max threads (default: 150)</p>
</li><li>
<p><strong>minSpareThreads</strong> = &#39;4&#39;,</p>
</li><li>
<p><strong>connectionTimeout</strong> = &#39;20000&#39;,</p>
</li><li>
<p><strong>lockoutrealm</strong> = true,</p>
</li><li>
<p><strong>userdatabase</strong> = true,</p>
</li><li>
<p><strong>extra_vars</strong> = undef,</p>
</li><li>
<p><strong>system_properties</strong> = undef,</p>
</li><li>
<p><strong>rmi_server_hostname</strong> = undef,</p>
</li><li>
<p><strong>catalina_rotate</strong>: if eyp-logrotate is available defines a
daily catalina.out rotation with this value retention (default: 15)</p>
</li><li>
<p><strong>catalina_size</strong>: if eyp-logrotate is available defines a max
size to rotate catalina.out (default: 100M)</p>
</li><li>
<p><strong>heapdump_oom_dir</strong>: heapdump dir, if defined enables
heapdumping (default: undef)</p>
</li><li>
<p><strong>install_tomcat_manager</strong> = true,</p>
</li><li>
<p><strong>shutdown_command</strong>: shutdown command for the shutdown port
(default: eyptomcat::shutdowncommand which, by default, is SHUTDOWN)</p>
</li><li>
<p><strong>java_library_path</strong>: -Djava.library.path (default: undef)</p>
</li><li>
<p><strong>java_home</strong> = undef,</p>
</li><li>
<p><strong>webapps_owner</strong>: webapps folder owner</p>
</li><li>
<p><strong>webapps_group</strong>: webapps folder group</p>
</li><li>
<p><strong>webapps_mode</strong>: webapps folder mode</p>
</li><li>
<p><strong>custom_webxml</strong>: copies web.xml from catalina_home to
catalina_base. If you need to use a <strong>custom web.xml</strong> you are
going to need to set it to <strong>true</strong>. (default: false)</p>
</li><li>
<p><strong>catalina_stop_options</strong>: Options to stop tomcat (default:
stop) - It must be a string</p>
</li><li>
<p><strong>use_par_new_gc</strong>: Uses a parallel version of the young
generation copying collector alongside the default collector. This
minimizes pauses by using all available CPUs in parallel. The collector is
compatible with both the default collector and the Concurrent Mark and
Sweep (CMS) collector.</p>
</li><li>
<p><strong>max_tenuring_threshold</strong>: reduce the amount of time spent in
data copying in the young generation collection while avoiding promoting
too many objects, by noting tenuring ages in the GC logs (default: undef)</p>
</li><li>
<p><strong>survivor_ratio</strong>: Ratio of eden/survivor space size
(default: undef)</p>
</li><li>
<p><strong>unlock_diagnostic_vm_options</strong> = false,</p>
</li><li>
<p><strong>par_gc_cards_per_stride_chunk</strong>: controls the granularity of
tasks given to GC worker threads and helps get the best performance
(default: undef)</p>
</li><li>
<p><strong>bind_gc_task_threads_to_cpus</strong> : binds GC threads to
individual CPU cores (default: false)</p>
</li><li>
<p><strong>use_gc_task_affinity</strong>: allocates tasks to GC worker threads
using an affinity parameter if implemented (default: false)</p>
</li><li>
<p><strong>always_pre_touch</strong>: It pretouchs and set zero all the pages
you have allocated during the initialization of your application (default:
false)</p>
</li><li>
<p><strong>scavenge_before_full_gc</strong>: Do young generation GC prior to a
full GC (default: false)</p>
</li><li>
<p><strong>agressive_opts</strong>: Turn on point performance compiler
optimizations that are expected to be default in upcoming releases
(default: false)</p>
</li><li>
<p><strong>use_biased_locking</strong>: Enable biased locking (default: false)</p>
</li><li>
<p><strong>print_gc_cause</strong> = false,</p>
</li><li>
<p><strong>target_survivor_ratio</strong>: Desired percentage of survivor
space used after scavenge (default: undef)</p>
</li><li>
<p><strong>parallel_gc_threads</strong>: Sets the number of garbage collection
threads in the young and old parallel garbage collectors (default: undef)</p>
</li><li>
<p><strong>jvm_prefer_ip4_stack</strong> = false,</p>
</li><li>
<p><strong>http_max_connections</strong> = undef,</p>
</li><li>
<p><strong>rmi_port</strong> = undef,</p>
</li><li>
<p><strong>connector_ajp_accept_count</strong> = undef,</p>
</li><li>
<p><strong>connector_ajp_acceptor_threadcount</strong> = undef,</p>
</li></ul>

<h4 id="label-tomcat%3A%3Aagent">tomcat::agent</h4>
<ul><li>
<p><strong>jar_name</strong>: jar to deploy (required)</p>
</li><li>
<p><strong>agent_name</strong>: agent name, agent will be deployed on
<strong>catalina_base</strong>/<strong>agent_name</strong> (required)</p>
</li><li>
<p><strong>install_type</strong>: installation type: source/tar/link (default:
tar)</p>
</li><li>
<p><strong>source</strong>: file source, must be a puppet resource (for
installation type <strong>source</strong>)</p>
</li><li>
<p><strong>file_ln</strong>: jar already in place, just add a softlink to it
(for installation type <strong>link</strong>)</p>
</li><li>
<p><strong>tar_source</strong>: tar source, must be a puppet resource (for
installation type <strong>tar</strong>)</p>
</li><li>
<p><strong>catalina_base</strong>: (default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: (default: $name)</p>
</li><li>
<p><strong>purge_old</strong>: purge old agent versions (default: false)</p>
</li><li>
<p><strong>ensure</strong>: (default: present)</p>
</li><li>
<p><strong>description</strong>: commet to add in the setenv file to identify
this agent (default: undef)</p>
</li><li>
<p><strong>srcdir</strong>: where to keep temporal files for tar based
installation type (default: /usr/local/src)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Adriver%3A%3Apostgres">tomcat::driver::postgres</h4>

<p>Install postgres driver for a given tomcat instance:</p>
<ul><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li><li>
<p><strong>jdbc_version</strong> = &#39;4&#39;,</p>
</li><li>
<p><strong>postgres_version</strong> = &#39;9.2&#39;,</p>
</li><li>
<p><strong>srcdir</strong> = &#39;/usr/local/src&#39;,</p>
</li><li>
<p><strong>ensure</strong> = &#39;present&#39;,</p>
</li></ul>

<h4 id="label-tomcat%3A%3Aauthenticators">tomcat::authenticators</h4>
<ul><li>
<p><strong>basic</strong> =
&#39;org.apache.catalina.authenticator.BasicAuthenticator&#39;,</p>
</li><li>
<p><strong>form</strong> =
&#39;org.apache.catalina.authenticator.FormAuthenticator&#39;,</p>
</li><li>
<p><strong>clientcert</strong> =
&#39;org.apache.catalina.authenticator.SSLAuthenticator&#39;,</p>
</li><li>
<p><strong>digest</strong> =
&#39;org.apache.catalina.authenticator.DigestAuthenticator&#39;,</p>
</li><li>
<p><strong>none</strong> =
&#39;org.apache.catalina.authenticator.NonLoginAuthenticator&#39;,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Acontext">tomcat::context</h4>
<ul><li>
<p><strong>sessionCookiePath</strong> = undef,</p>
</li><li>
<p><strong>watchedResource</strong> = &#39;WEB-INF/web.xml&#39;,</p>
</li><li>
<p><strong>manager</strong> = &#39;&#39;,</p>
</li><li>
<p><strong>antiJARLocking</strong> = false,</p>
</li><li>
<p><strong>antiResourceLocking</strong> = false,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li><li>
<p><strong>path</strong>: (default: undef)</p>
</li><li>
<p><strong>session_cookie_name</strong>: change default session cookie name
(default: undef, <strong>JSESSIONID</strong>)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Ajaas">tomcat::jaas</h4>
<ul><li>
<p><strong>app</strong>,</p>
</li><li>
<p><strong>provider</strong>,</p>
</li><li>
<p><strong>filter</strong>,</p>
</li><li>
<p><strong>username</strong> = &#39;tomcat&#39;,</p>
</li><li>
<p><strong>password</strong> = &#39;tomcat&#39;,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Ajndi">tomcat::jndi</h4>
<ul><li>
<p><strong>ldapservers</strong>,</p>
</li><li>
<p><strong>ldapbase</strong>,</p>
</li><li>
<p><strong>ldapadmin</strong>,</p>
</li><li>
<p><strong>ldapadminpassword</strong>,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Alib">tomcat::lib</h4>
<ul><li>
<p><strong>jar_name</strong>,</p>
</li><li>
<p><strong>source</strong> = undef,</p>
</li><li>
<p><strong>file_ln</strong> = undef,</p>
</li><li>
<p><strong>purge_old</strong>: purge other versions of this library (default:
true)</p>
</li><li>
<p><strong>ensure</strong> = &#39;present&#39;,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Alibstarball">tomcat::libstarball</h4>
<ul><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li><li>
<p><strong>source</strong>,</p>
</li><li>
<p><strong>libstarballname</strong> = $name,</p>
</li><li>
<p><strong>purge_old</strong> = false,</p>
</li></ul>

<h4 id="label-tomcat%3A%3Aproperties">tomcat::properties</h4>
<ul><li>
<p><strong>source</strong>,</p>
</li><li>
<p><strong>properties_file</strong>,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li><li>
<p><strong>dir</strong>: properties directory (default: conf)</p>
</li></ul>

<h4 id="label-tomcat%3A%3Aresource">tomcat::resource</h4>
<ul><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li><li>
<p><strong>resource_type</strong></p>
</li><li>
<p><strong>resource_name</strong>,</p>
</li><li>
<p><strong>factory</strong> = undef,</p>
</li><li>
<p><strong>driver_class_name</strong> = undef,</p>
</li><li>
<p><strong>resource_url</strong> = undef,</p>
</li><li>
<p><strong>username</strong> = undef,</p>
</li><li>
<p><strong>password</strong> = undef,</p>
</li><li>
<p><strong>initial_size</strong> = undef,</p>
</li><li>
<p><strong>max_active</strong> = undef,</p>
</li><li>
<p><strong>max_idle</strong> = undef,</p>
</li><li>
<p><strong>min_idle</strong> = undef,</p>
</li><li>
<p><strong>validation_query</strong> = undef,</p>
</li><li>
<p><strong>min_evictable_idletimemillis</strong> = undef,</p>
</li><li>
<p><strong>time_between_evictionrunsmillis</strong> = undef,</p>
</li><li>
<p><strong>numtests_per_evictionrun</strong> = undef,</p>
</li><li>
<p><strong>init_sql</strong> = undef,</p>
</li><li>
<p><strong>auth</strong> = undef,</p>
</li><li>
<p><strong>location</strong> = undef,</p>
</li></ul>

<h4 id="label-tomcat%3A%3Awebxml">tomcat::webxml</h4>
<ul><li>
<p><strong>source</strong>,</p>
</li><li>
<p><strong>catalina_base</strong>: catalina_base for the tomcat instance
(default: /opt/$name)</p>
</li><li>
<p><strong>servicename</strong>: tomcat&#39;s servicename (default:
resource&#39;s name)</p>
</li></ul>

<h4 id="label-tomcat%3Atomcatuser">tomcat:tomcatuser</h4>
<ul><li>
<p><strong>tomcatuser</strong>: username (mandatory)</p>
</li><li>
<p><strong>password</strong>: password (mandatory)</p>
</li><li>
<p><strong>catalina_base</strong>: catalina base (default:
/opt/&lt;resource&#39;s name&gt;)</p>
</li><li>
<p><strong>servicename</strong>: instance name (default: resource&#39;s name)</p>
</li><li>
<p><strong>pwdigest</strong>: password format, must match instance
configuration (default: sha)</p>
</li><li>
<p><strong>roles</strong>: list of roles (default: [ &#39;tomcat&#39;,
&#39;manager&#39;, &#39;admin&#39;, &#39;manager-gui&#39; ])</p>
</li></ul>

<h2 id="label-Limitations">Limitations</h2>

<p>Tested on: * CentOS 5 * CentOS 6 * CentOS 7 * Ubuntu 14.04 * Ubuntu 16.04</p>

<p>But should work anywhere</p>

<h2 id="label-Development">Development</h2>

<p>We are pushing to have acceptance testing in place, so any new feature must
have tests to check both presence and absence of any feature</p>

<h3 id="label-TODO">TODO</h3>
<ul><li>
<p>acceptance testing for <strong>tomcat::agent</strong></p>
</li><li>
<p>acceptance testing manage_service=false</p>
</li><li>
<p>review documentation for version 0.4 and 0.5</p>
</li><li>
<p>include files for server.xml</p>
</li><li>
<p>delete duplicated code for default vhost</p>
</li></ul>

<h3 id="label-Contributing">Contributing</h3>
<ol><li>
<p>Fork it</p>
</li><li>
<p>Create your feature branch (<code>git checkout -b my-new-feature</code>)</p>
</li><li>
<p>Commit your changes (<code>git commit -am &#39;Added some
feature&#39;</code>)</p>
</li><li>
<p>Push to the branch (<code>git push origin my-new-feature</code>)</p>
</li><li>
<p>Create new Pull Request</p>
</li></ol>
</div></div>

      <div id="footer">
  Generated on Mon Oct 23 15:03:56 2017 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.9 (ruby-2.1.9).
</div>

    </div>
  </body>
</html>